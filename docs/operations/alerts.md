# Операционные алерты

Ниже приведены основные метрики, за которыми необходимо следить, и базовые шаги реагирования.

## p95

- **Описание:** рост времени отклика p95.
- **Действия:**
  1. Перезапустить соответствующий сервис.
  2. Расширить ресурсы: увеличить количество реплик или выделенную память/CPU.
  3. При необходимости проанализировать долгие запросы и оптимизировать их.

## dropped

- **Описание:** увеличенное число потерянных обновлений.
- **Действия:**
  1. Перезапустить сервис, обрабатывающий входящие обновления.
  2. Сбросить конфигурацию вебхука и заново её установить.
  3. При продолжении проблемы временно переключиться на polling.

## error rate

- **Описание:** повышение доли ошибок при обработке запросов.
- **Действия:**
  1. Изучить логи и определить источник ошибок.
  2. Перезапустить сервис или зависимые компоненты.
  3. При нехватке ресурсов масштабировать инфраструктуру.

## queue overflow

- **Описание:** переполнение очереди сообщений.
- **Действия:**
  1. Расширить размер очереди или число воркеров.
  2. Временно снизить входной трафик.
  3. Перезапустить обработчики для освобождения зависших сообщений.

## деградация стор

- **Описание:** проблемы с производительностью или доступностью хранилища.
- **Действия:**
  1. Переключиться на резервный стор при его наличии.
  2. Увеличить ресурсы хранилища или провести балансировку.
  3. Перезапустить сервисы, использующие стор, после восстановления.

## Пример конфигурации Alertmanager

```yaml
route:
  receiver: 'ops-team'
  group_by: ['alertname']
  repeat_interval: 1h

receivers:
  - name: 'ops-team'
    telegram_configs:
      - bot_token: '<token>'
        chat_id: '<chat>'
```

